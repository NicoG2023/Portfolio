@import "@fontsource/inter/400.css";
@import "@fontsource/inter/500.css";
@import "@fontsource/inter/600.css";
@import "@fontsource/jetbrains-mono/400.css";
@import "@fontsource/jetbrains-mono/500.css";

@import "tailwindcss";
@import "./styles/theme.css";

/* =========================
   ROOT HEIGHT / STACKING
   ========================= */

html,
body {
  height: 100%;
}

body {
  min-height: 100%;
}

#root {
  min-height: 100%;
  position: relative;
  z-index: 0;
}

/* =========================
   BACKGROUND (píntalo en BODY)
   - Esto evita “cortes” por canvas/propagation en algunos casos
   ========================= */

body {
  color: rgb(var(--text));
  background-color: rgb(var(--bg));
  overflow-x: hidden;

  /* Importante: fija el background para evitar tiles raros al scrollear/zoomear */
  background-attachment: fixed;

  background-image:
    /* grid suave */
    radial-gradient(rgb(var(--accent) / 0.10) 1px, transparent 1px),
    radial-gradient(rgb(var(--accent) / 0.06) 0.8px, transparent 0.8px),

    /* blobs */
    radial-gradient(900px 520px at 18% 12%, rgb(var(--crimson) / 0.10), transparent 70%),
    radial-gradient(820px 520px at 54% 0%, rgb(var(--accent) / 0.12), transparent 66%),
    radial-gradient(760px 520px at 88% 36%, rgb(var(--crimson) / 0.08), transparent 68%),
    radial-gradient(900px 600px at 22% 92%, rgb(var(--accent) / 0.09), transparent 74%),
    radial-gradient(900px 600px at 84% 96%, rgb(var(--accent) / 0.07), transparent 72%),

    /* vignette suave */
    radial-gradient(circle at 50% 50%, transparent 55%, rgb(var(--ink) / 0.05) 100%);

  background-size:
    26px 26px,
    44px 44px,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%;

  background-position:
    0 0,
    12px 16px,
    0 0,
    0 0,
    0 0,
    0 0,
    0 0,
    0 0;

  background-repeat: repeat, repeat, no-repeat, no-repeat, no-repeat, no-repeat, no-repeat, no-repeat;
}

/* Dark mode: sigue pintando en BODY */
html.dark body,
body.dark {
  background-color: rgb(var(--bg));
  background-attachment: fixed;

  background-image:
    radial-gradient(rgb(var(--accent) / 0.085) 0.9px, transparent 0.9px),
    radial-gradient(rgb(var(--accent) / 0.055) 0.8px, transparent 0.8px),

    radial-gradient(900px 520px at 18% 12%, rgb(var(--crimson) / 0.10), transparent 70%),
    radial-gradient(820px 520px at 54% 0%, rgb(var(--accent) / 0.14), transparent 66%),
    radial-gradient(760px 520px at 88% 36%, rgb(var(--crimson) / 0.09), transparent 68%),
    radial-gradient(900px 600px at 22% 92%, rgb(var(--accent) / 0.10), transparent 74%),
    radial-gradient(900px 600px at 84% 96%, rgb(var(--accent) / 0.08), transparent 72%),

    radial-gradient(circle at 50% 55%, transparent 45%, rgb(0 0 0 / 0.55) 100%);

  background-size:
    26px 26px,
    44px 44px,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%,
    100% 100%;

  background-position:
    0 0,
    12px 16px,
    0 0,
    0 0,
    0 0,
    0 0,
    0 0,
    0 0;

  background-repeat: repeat, repeat, no-repeat, no-repeat, no-repeat, no-repeat, no-repeat, no-repeat;
}

/* ✅ IMPORTANTE: apagamos overlays viejos */
body::after {
  content: none !important;
}
html.dark body::after,
body.dark::after {
  content: none !important;
}

/* =========================
   GRAIN / FILM OVERLAY (SIN mix-blend-mode)
   - mix-blend-mode + fixed suele crear “seams” que cambian con zoom.
   - dejamos solo opacity normal.
   ========================= */

@keyframes grainShift {
  0%,
  100% { transform: translate3d(0, 0, 0); }
  50% { transform: translate3d(-1.5%, 1.5%, 0); }
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0; /* encima del background, debajo del contenido */

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
  opacity: 0.10;

  /* clave: NO blend */
  mix-blend-mode: normal;

  animation: grainShift 18s steps(2) infinite;
  will-change: transform;
}

/* Contenido encima del grain */
#root {
  position: relative;
  z-index: 1;
}

/* Chromium perf */
html.chromium body::before {
  animation: none !important;
  opacity: 0.07;
}

/* Dark tuning */
html.dark body::before,
body.dark::before {
  opacity: 0.11;
  mix-blend-mode: normal;
}

html.chromium.dark body::before,
html.chromium body.dark::before {
  opacity: 0.08;
}

/* =========================
   ACCESSIBILITY
   ========================= */

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
  body::before {
    animation: none !important;
  }
}

/* =========================
   (Opcional) Animaciones blobs
   ========================= */

@keyframes blobFloatY {
  0%, 100% { transform: translate3d(-50%, 0, 0) scale(1); }
  50% { transform: translate3d(-50%, -18px, 0) scale(1.03); }
}

@keyframes blobFloatYPlain {
  0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
  50% { transform: translate3d(0, -16px, 0) scale(1.025); }
}

@keyframes blobDriftXPlain {
  0%, 100% { transform: translate3d(0, 0, 0); }
  50% { transform: translate3d(16px, 0, 0); }
}

.bg-blob-float-center { animation: blobFloatY 52s ease-in-out infinite; }
.bg-blob-float { animation: blobFloatYPlain 58s ease-in-out infinite; }
.bg-blob-drift { animation: blobDriftXPlain 72s ease-in-out infinite; }

.bg-delay-1 { animation-delay: -9s; }
.bg-delay-2 { animation-delay: -18s; }
.bg-delay-3 { animation-delay: -27s; }

@media (prefers-reduced-motion: reduce) {
  .bg-blob-float-center,
  .bg-blob-float,
  .bg-blob-drift {
    animation: none !important;
  }
}

/* =========================
   UPDATE: SLOW DEVICES
   ========================= */

@media (update: slow) {
  body::before {
    animation: none !important;
  }
  .bg-blob-float-center,
  .bg-blob-float,
  .bg-blob-drift {
    animation: none !important;
  }
}

/* =========================
   GLASS (performance-friendly)
   ========================= */

.glass {
  background-color: rgb(var(--surface) / 0.72);
  border: 1px solid rgb(var(--border));
  box-shadow: 0 10px 30px rgb(0 0 0 / 0.08);
}

@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  .glass {
    background-color: rgb(var(--surface) / 0.60);
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
  }
}

html.chromium .glass {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  background-color: rgb(var(--surface) / 0.78);
}

html.chromium .backdrop-blur-sm,
html.chromium .backdrop-blur-md,
html.chromium .backdrop-blur-lg,
html.chromium [class*="backdrop-blur"] {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
}

html.chromium .bg-surface\/70,
html.chromium .bg-surface\/75,
html.chromium .bg-bg\/25 {
  background-color: rgb(var(--surface) / 0.80) !important;
}

/* =========================================
   Content Visibility helpers (perf)
   ========================================= */

.cv-auto {
  content-visibility: auto;
  contain-intrinsic-size: 1px 900px;
}

.cv-visible {
  content-visibility: visible;
  contain-intrinsic-size: auto;
}

.contain-paint {
  contain: layout paint;
}
